<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>Beamer Player</title>
    <style>
      html, body {
        margin: 0;
        padding: 0;
        width: 100%;
        height: 100%;
        background: black;
        color: white;
        font-family: system-ui, sans-serif;
        display: flex;
        align-items: center;
        justify-content: center;
      }
      #root {
        text-align: center;
        max-width: 90vw;
      }
      img, video {
        margin-top: 20px;
        max-width: 90vw;
        max-height: 80vh;
        object-fit: contain;
      }
    </style>
  </head>
  <body>
    <div id="root">Starting player...</div>

    <script>
      const { initPlayer } = require("../player-core/dist/index.js");

      function renderCreative(creative) {
        const root = document.getElementById("root");
        const src = creative.local_file_path || creative.file_url;

        if (creative.type === "video") {
          root.innerHTML = `
            <div>Now Playing (VIDEO):</div>
            <div><strong>${creative.creative_id}</strong></div>
            <div>${creative.duration_seconds}s</div>
            <video id="creative-video"
                   src="${src}"
                   autoplay
                   muted
                   playsinline
                   loop></video>
          `;
          const video = document.getElementById("creative-video");
          if (video) {
            video.play().catch(() => {});
          }
        } else {
          root.innerHTML = `
            <div>Now Playing (IMAGE):</div>
            <div><strong>${creative.creative_id}</strong></div>
            <div>${creative.duration_seconds}s</div>
            <img src="${src}" alt="Creative" />
          `;
        }
      }

      function showError(err) {
        const root = document.getElementById("root");
        const message =
          (err && err.message) ||
          (typeof err === "string" ? err : "Unknown player error");

        console.error("Beamer player failed to start:", err);

        root.innerHTML = `
          <div style="padding: 24px; font-family: system-ui; color: #ff8080;">
            <div style="font-size: 20px; font-weight: bold; margin-bottom: 8px;">
              Player Error
            </div>
            <div style="font-size: 14px;">
              ${message}
            </div>
          </div>
        `;
      }

      (async () => {
        try {
          await initPlayer(renderCreative);
        } catch (err) {
          showError(err);
        }
      })();
    </script>

  </body>
</html>
