We’ve already implemented:

Phase 1: Extended screen metadata (classification, vehicles, lat/long)

Phase 2: Classification-aware Screens UI

Phase 3A: Publishers & Advertisers separation + Screens wired to publisher_profiles

Now I want to refine the Screens experience by:

Auto-generating a human-friendly Screen Code for each screen (no manual name required).

Making publisher assignment optional when creating a screen (for internal users).

Removing the now-redundant Organisations item from the CMS navigation (since we now have Publishers & Advertisers).

These changes must be backward-compatible and must NOT break:

Existing screens

Player assignment

Classifications

Publishers/Advertisers

Any existing API consumers

1. BACKEND — AUTO-GENERATED SCREEN CODE
1.1 Add code column to screens table

Add a new column to screens:

code text NOT NULL UNIQUE


We will treat code as the primary human-facing identifier for a screen.

Backfill existing records

For all existing screens:

Generate a code with a simple deterministic pattern, e.g.:

SCR-00001, SCR-00002, SCR-00003, ...

You can base the sequence on:

created_at ascending

or id ascending

Just ensure:

All existing screens get a unique code

No code is null

1.2 Screen code generation for new screens

Update the screen creation flow (POST /api/screens) so that:

code is always generated on the backend.

Any code sent from the client is ignored.

Code format can be:

SCR-<zero-padded-sequence>, e.g. SCR-00024

You can implement a simple helper, e.g.:

Query the max numeric part so far and increment

Or use a monotonic sequence table

Or use a short nanoid-based code with a prefix like SCR-A1B2C3 (as long as it’s unique and human-readable).

Choose a simple and safe approach; we don’t need anything fancy yet, just:

Unique

Stable

Human-friendly

1.3 Make name optional (no longer required)

If name is currently required in the validation for POST /api/screens and/or PATCH /api/screens/:id:

Make name optional.

Do not remove the name field from the DB.

This becomes a display / override name, not the primary identifier.

The primary identifier from now on is code.

Do NOT break existing screens that already have names; keep them.

2. BACKEND — PUBLISHER SHOULD BE OPTIONAL ON SCREEN CREATE (INTERNAL)

Right now, the Phase 3A changes made publisherId required for internal users (as Replit indicated earlier).

Change this:

2.1 Make publisherId optional in validation

Update screen creation/update validation so that:

publisherId is optional for internal users.

It MUST still be validated if provided (must exist and permissions must allow it).

2.2 Behaviour by user type

Internal users (beamer_internal):

Can create screens with or without publisherId.

If publisherId is omitted:

The screen is created with publisherId = null.

Publisher users:

Keep existing behaviour: when a publisher user creates a screen, it should automatically be linked to their own publisher profile.

They should NOT be able to create screens for other publishers.

It is acceptable for publisher users to NOT be able to create screens with publisherId = null.

Advertiser users:

Must still not have access to Screens.

Ensure this optionality is implemented both in:

The request validation

The service layer logic (i.e., no assumptions that publisherId is always present)

3. FRONTEND — SCREEN FORM + LIST + DETAIL UPDATES
3.1 ScreenFormModal — Screen Code & Publisher Optionality

File: cms-web/src/components/ScreenFormModal.tsx

Screen Code

For create mode:

Do NOT show a “Screen Code” input (since it’s generated by the backend).

Optionally show a read-only hint like “Code will be generated after creation”.

For edit mode:

Show a read-only “Screen Code” field displaying screen.code.

This should NOT be editable by the user.

If code is missing for some legacy screen, handle gracefully (show “—” or similar).

Publisher field

For internal users:

Change the publisher dropdown so that it is truly optional.

Remove any “required” validation for publisherId for internal.

Allow submitting the form with no publisher selected (payload publisherId: null).

For publisher users:

Keep existing behaviour:

The publisher is auto-determined as their own.

The publisher input remains read-only / disabled.

Make sure the client payload matches the new backend behaviour:

publisherId is included when selected.

publisherId can be absent or null for internal.

3.2 Screens list page — show Screen Code

File: cms-web/src/pages/Screens.tsx

Add a “Code” column to the screens table.

Display screen.code.

If code is missing (for very old/legacy data), display “—”.

Preferably, make “Code” the left-most or one of the first columns, since this is the primary identifier.

Keep the “Name” (if present) as an optional/secondary column or in the detail view.

3.3 Screen detail page — show Screen Code prominently

File: cms-web/src/pages/ScreenDetail.tsx

In the header area of the Screen Detail (or the top section of Overview):

Display screen.code clearly (e.g., as the primary title or a label).

If screen.name exists, you can show it as a subtitle or “Display Name”.

This way, ops and internal teams can refer to screens by a stable code.

4. FRONTEND — REMOVE “ORGANISATIONS” FROM NAVIGATION

We have now separated:

Publishers (with publisher_profiles)

Advertisers (as organisations with category advertiser)

The old “Organisations” navigation entry is now redundant for day-to-day use.

4.1 Remove Organisations from sidebar/top nav

Locate where the CMS navigation is defined (e.g., AppLayout, navigation config, etc.) and:

Remove the “Organisations” item from the sidebar/top nav for internal users.

Ensure that navigation now focuses on:

Inventory (Screens, Map if implemented, etc.)

Publishers

Advertisers

Campaigns

Reporting

4.2 Keep backend & pages intact (for now)

Do NOT delete backend organisations endpoints.

Do NOT delete the existing Organisations pages or routes.

Just hide the navigation entry.

This keeps things backward-compatible while aligning the UX with the new Publishers/Advertisers model.

5. VALIDATION & NON-BREAKING REQUIREMENTS

After implementing all the above:

Confirm:

Backend builds successfully (no TypeScript errors).

Frontend builds successfully.

Test:

Internal user:

Can create a screen without selecting a publisher.

Can create a screen with a publisher.

In both cases, a Screen Code is auto-generated and displayed in list/detail.

Publisher user:

Can create a screen and it is auto-linked to their publisher.

Screen list shows Code column.

Screen detail shows Screen Code clearly.

Confirm:

Player assignment still works.

Screen classification still works.

Publishers/Advertisers pages still function.

“Organisations” no longer appears in the nav, but nothing crashes.

Finally, summarise:

DB changes (screens.code, any other changes).

How Screen Code is generated.

Files changed in the CMS for form, list, detail, and nav.

Example JSON of a screen object including code, name (optional), publisherId.